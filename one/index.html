
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="https://pcsx-redux.consoledev.net/one/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.1.2, mkdocs-material-7.1.3" name="generator"/>
<title>One - PCSX-Redux</title>
<link href="../assets/stylesheets/main.e35208c4.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.ef6f36e2.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
<link href="../css/extra.css" rel="stylesheet"/>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#menus">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="PCSX-Redux" class="md-header__button md-logo" data-md-component="logo" href=".." title="PCSX-Redux">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            PCSX-Redux
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              One
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"></path></svg>
</label>
<input class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/grumpycoders/pcsx-redux/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="PCSX-Redux" class="md-nav__button md-logo" data-md-component="logo" href=".." title="PCSX-Redux">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"></path></svg>
</a>
    PCSX-Redux
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/grumpycoders/pcsx-redux/" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Home
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../menus/">
        PCSX-Redux menus
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../compiling/">
        Compiling PCSX-Redux
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cli_flags/">
        Command Line Flags
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gdb-server/">
        GDB server
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mips_api/">
        Mips API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../CPU_trace_dump/">
        Dumping a CPU trace to a file
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../web_server/">
        Web server
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lua/">
        Lua API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../openbios/">
        Openbios
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#menus">
    Menus
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pcsx-redux-menus">
    PCSX-Redux menus
  </a>
<nav aria-label="PCSX-Redux menus" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#file">
    File
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#emulation">
    Emulation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
    Configuration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug">
    Debug
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#help">
    Help
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gpu-information">
    GPU information
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling">
    Compiling
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-pcsx-redux">
    Compiling PCSX-Redux
  </a>
<nav aria-label="Compiling PCSX-Redux" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-the-sources">
    Getting the sources
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#windows">
    Windows
  </a>
<nav aria-label="Windows" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#openbios">
    Openbios
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#linux">
    Linux
  </a>
<nav aria-label="Linux" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-with-docker">
    Compiling with Docker
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-with-make">
    Compiling with make
  </a>
<nav aria-label="Compiling with make" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#openbios_1">
    Openbios
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#macos">
    MacOS
  </a>
<nav aria-label="MacOS" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#openbios_2">
    Openbios
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#compiling-psx-code">
    Compiling PSX code
  </a>
<nav aria-label="Compiling PSX code" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-the-toolchain-on-windows">
    Getting the toolchain on Windows
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#getting-the-toolchain-on-gnulinux">
    Getting the toolchain on GNU/Linux
  </a>
<nav aria-label="Getting the toolchain on GNU/Linux" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#debian-derivative-ubuntu-mint">
    Debian derivative; Ubuntu, Mint...
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#arch-derivative-manjaro">
    Arch derivative; Manjaro...
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cli-flags">
    Cli &amp; flags
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#command-line-flags">
    Command Line Flags
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gdb-server">
    GDB server
  </a>
<nav aria-label="GDB server" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#enabling-the-gdb-server">
    Enabling the GDB server
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gdb-setup">
    GDB setup
  </a>
<nav aria-label="GDB setup" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#windows_1">
    Windows
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gnulinux">
    GNU/Linux
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ide-setup">
    IDE setup
  </a>
<nav aria-label="IDE setup" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ms-vscode">
    MS VScode
  </a>
<nav aria-label="MS VScode" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#target">
    target
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gdbpath">
    gdbpath
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autorun">
    autorun
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#geany">
    Geany
  </a>
<nav aria-label="Geany" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#gdbinit">
    .gdbinit
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#plugin-configuration">
    Plugin configuration
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#beginning-debugging">
    Beginning Debugging
  </a>
<nav aria-label="Beginning Debugging" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#starting-debugging-in-geany">
    Starting debugging in Geany
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#additional-tools">
    Additional tools
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mips-api">
    Mips &amp; api
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mips-api_1">
    Mips API
  </a>
<nav aria-label="Mips API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#description">
    Description
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#functions">
    Functions
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cpu-trace-dump">
    Cpu, trace &amp; dump
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dumping-a-cpu-trace-to-a-file">
    Dumping a CPU trace to a file
  </a>
<nav aria-label="Dumping a CPU trace to a file" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#setup">
    Setup
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#begin-dump">
    Begin dump
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#source">
    Source
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#web-server">
    Web &amp; server
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#web-server_1">
    Web server
  </a>
<nav aria-label="Web server" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#activation">
    Activation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#rest-api">
    REST API
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lua">
    Lua
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lua-api">
    Lua API
  </a>
<nav aria-label="Lua API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#lua-engine">
    Lua engine
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lua-console">
    Lua console
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lua-editor">
    Lua editor
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api">
    API
  </a>
<nav aria-label="API" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#basic-lua">
    Basic Lua
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dear-imgui">
    Dear ImGui
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#opengl">
    OpenGL
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#luv">
    Luv
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#zlib">
    Zlib
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pcsx-redux">
    PCSX-Redux
  </a>
<nav aria-label="PCSX-Redux" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#imgui-interaction">
    ImGui interaction
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#memory-and-registers">
    Memory and registers
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#execution-flow">
    Execution flow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#messages">
    Messages
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gui">
    GUI
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#breakpoints">
    Breakpoints
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#case-studies">
    Case studies
  </a>
<nav aria-label="Case studies" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#spyro-year-of-the-dragon">
    Spyro: Year of the Dragon
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#openbios_3">
    Openbios
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#openbios_4">
    Openbios
  </a>
<nav aria-label="Openbios" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#purposes-of-openbios">
    Purposes of Openbios
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building">
    Building
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#status">
    Status
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#organization">
    Organization
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#technicalities">
    Technicalities
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#commentary">
    Commentary
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#legality">
    Legality
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/grumpycoders/pcsx-redux/edit/docs/docs/one.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h2 id="menus">Menus</h2>
<h1 id="pcsx-redux-menus">PCSX-Redux menus</h1>
<p>The menu bar holds some informations :</p>
<p><img alt="file menu" src="../images/pcsx_menu_oview.png"/></p>
<ul>
<li>CPU mode</li>
<li>Game ID</li>
<li>ImGui FPS counter (not psx internal fps)</li>
</ul>
<h2 id="file">File</h2>
<p><img alt="file menu" src="../images/pcsx_menu_file.png"/></p>
<ul>
<li>Open ISO</li>
<li>Close ISO</li>
<li>Load Binary</li>
<li>Dump save state proto schema</li>
<li>Save state slots</li>
<li>Load state slots</li>
<li>Save global state</li>
<li>Load global state</li>
<li>Open Lid : Simulate open lid</li>
<li>Close Lid : Simulate closed lid</li>
<li>Open and Close Lid : Simulate opening then closing the lid</li>
<li>MC1 inserted: Insert or remove Memory Card 1</li>
<li>MC2 inserted: Insert or remove Memory Card 2</li>
<li>Reboot : Restart emulator</li>
<li>Quit</li>
</ul>
<h2 id="emulation">Emulation</h2>
<p><img alt="emulation menu" src="../images/pcsx_menu_emu.png"/></p>
<ul>
<li>Start (F5): Start execution</li>
<li>Pause (F6): Pause execution</li>
<li>Soft reset (F8): Calls Redux's CPU reset function, which jumps to the BIOS entrypoint (0xBFC00000), resets some COP0 registers and the general purpose registers, and resets some IO. Does not clear vram.</li>
<li>Hard reset (Shift-F8): Similar to a reboot of the PSX.</li>
</ul>
<h2 id="configuration">Configuration</h2>
<p><img alt="configuration menu" src="../images/pcsx_menu_config.png"/></p>
<ul>
<li>Emulation : Emulation settings</li>
<li>GPU : Graphics Processing Unit settings</li>
<li>SPU : Sound Processing Unit settings</li>
<li>UI : Change user interface settings (such as font size, language or UI theme)</li>
<li>Controls : Edit KB/Pad controls</li>
<li>Shader presets : Apply a shader preset</li>
<li>Configure shaders : Show shader editor</li>
</ul>
<h2 id="debug">Debug</h2>
<p><img alt="debug menu" src="../images/pcsx_menu_debug.png"/></p>
<h2 id="help">Help</h2>
<ul>
<li>Show ImGui demo</li>
<li>About</li>
</ul>
<h2 id="gpu-information">GPU information</h2>
<p>The 'About' dialog available in the 'Help' menu has an 'OpenGL information' tab that displays information on the GPU currently used by the program, such as the supported OpenGL extensions.</p>
<p><img alt="GPU infos" src="../images/gpu_infos.png"/></p>
<h2 id="compiling">Compiling</h2>
<h1 id="compiling-pcsx-redux">Compiling PCSX-Redux</h1>
<h2 id="getting-the-sources">Getting the sources</h2>
<p>The only location for the source is <a href="https://github.com/grumpycoders/pcsx-redux/">on github</a>. Clone recursively, as the project uses submodules: </p>
<p><code>git clone https://github.com/grumpycoders/pcsx-redux.git --recursive</code>.</p>
<h2 id="windows">Windows</h2>
<p>Install <a href="https://visualstudio.microsoft.com/thank-you-downloading-visual-studio/?sku=Community&amp;rel=16">Visual Studio 2019 Community Edition</a>. <br/>
Open the file <code>vsprojects\pcsx-redux.sln</code>, select <code>pcsx-redux -&gt; pcsx-redux</code>, right click, <code>Set as Startup Project</code>, and hit <code>F7</code> to build.<br/>
The project follows the open-and-build paradigm with no extra step, so no specific dependency ought to be needed, as <a href="https://www.nuget.org/">NuGet</a>
will take care of downloading them automatically for you on the first build.</p>
<p>Note: If you get an error saying <code>hresult e_fail has been returned from a call to a com component</code>, you might need to delete the .suo file in vsproject/vs, restart Visual Studio and retry.</p>
<h4 id="openbios">Openbios</h4>
<p>Using <a href="https://code.visualstudio.com/">Visual Studio Code</a>, one can use the task "make_openbios" to compile: CTRL-P then <code>task make_openbios</code> to compile.</p>
<h2 id="linux">Linux</h2>
<h3 id="compiling-with-docker">Compiling with Docker</h3>
<p>Run <code>./dockermake.sh</code>. You need <a href="https://en.wikipedia.org/wiki/Docker_(software)">docker</a> for this to work.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># Debian derivative; Ubuntu, Mint...</span>
sudo apt install docker
<span class="c1"># Arch derivative; Manjaro...</span>
sudo pacman -S docker
</code></pre></div>
</td></tr></table></p>
<p>You will also need a few libraries on your system for this to work. 
Check the <a href="https://github.com/grumpycoders/pcsx-redux/blob/main/tools/build/Dockerfile#L22">Dockerfile</a> for a list of library packages to install.</p>
<h3 id="compiling-with-make">Compiling with make</h3>
<ul>
<li>Debian derivatives ( for full emulator compilation ):</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sudo apt-get install -y build-essential git make pkg-config clang g++ g++-mipsel-linux-gnu cpp-mipsel-linux-gnu binutils-mipsel-linux-gnu libfreetype-dev libavcodec-dev libavformat-dev libavutil-dev libglfw3-dev libswresample-dev libuv1-dev zlib1g-dev
</code></pre></div>
</td></tr></table>
<ul>
<li>Arch derivatives :</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sudo pacman -S clang git make pkg-config ffmpeg libuv zlib glfw-x11 curl xorg-server-xvfb
</code></pre></div>
</td></tr></table>
<p>You can then just enter the 'pcsx-redux' directory and compile without using docker with <code>make</code>.</p>
<p>If you have a different mips compiler, you'll need to override some variables, such as <code>PREFIX=mipsel-none-elf FORMAT=elf32-littlemips</code>.  </p>
<h4 id="openbios_1">Openbios</h4>
<p>Building <a href="../openbios/">OpenBIOS</a> on Linux can be done with docker : <code>./dockermake.sh openbios</code>,<br/>
or using <code>make</code>, with the <code>g++-mipsel-linux-gnu</code> package installed ; <code>make openbios</code>.  </p>
<h3 id="macos">MacOS</h3>
<p>You need MacOS Catalina with the latest XCode to build, as well as a few <a href="https://brew.sh/">homebrew</a> packages.<br/>
Run the <a href="https://github.com/grumpycoders/pcsx-redux/blob/main/.github/scripts/install-brew-dependencies.sh">brew installation script</a> to get all the necessary dependencies.</p>
<p>Run <code>make</code> to build.  </p>
<p>Compiling  <a href="../openbios/">OpenBIOS</a> will require a mips compiler, that you can generate using the following commands:  </p>
<h4 id="openbios_2">Openbios</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>brew install ./tools/macos-mips/mipsel-none-elf-binutils.rb
brew install ./tools/macos-mips/mipsel-none-elf-gcc.rb
</code></pre></div>
</td></tr></table>
<p>Then, you can compile  <a href="../openbios/">OpenBIOS</a> using <code>make -C ./src/mips/openbios</code>.</p>
<h2 id="compiling-psx-code">Compiling PSX code</h2>
<p>If you're only interested in compiling psx code, you can clone the PCSX-Redux repo; 
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>git clone https://github.com/grumpycoders/pcsx-redux.git --recursive
</code></pre></div>
</td></tr></table>
then install a mips toolchain and get the converted PsyQ libraries in the <code>pcsx-redux/src/mips/psyq/</code> folder as per  <a href="https://github.com/ABelliqueux/pcsx-redux/blob/main/src/mips/psyq/README.md">these instructions</a>.</p>
<p>You can also <a href="https://github.com/ABelliqueux/nolibgs_hello_worlds/blob/main/README.md#nugget--psyq-setup">find the pre-compiled converted Psyq libraries online</a>.</p>
<h3 id="getting-the-toolchain-on-windows">Getting the toolchain on Windows</h3>
<p>Download the MIPS toolchain here : <a href="http://static.grumpycoder.net/pixel/mips/g++-mipsel-none-elf-10.3.0.zip">https://static.grumpycoder.net/pixel/mips/g++-mipsel-none-elf-10.3.0.zip</a><br/>
and add the <code>bin</code> folder to <a href="https://stackoverflow.com/questions/44272416/how-to-add-a-folder-to-path-environment-variable-in-windows-10-with-screensho#44272417">your $PATH</a>.<br/>
You can test it's working by <a href="https://www.lifewire.com/how-to-open-command-prompt-2618089">launching a command prompt</a> and typing <code>mipsel-none-elf-gcc.exe --version</code>. If you get a message like <code>mipsel-none-gnu-gcc (GCC) 10.3.0</code>, then it's working !</p>
<h3 id="getting-the-toolchain-on-gnulinux">Getting the toolchain on GNU/Linux</h3>
<h4 id="debian-derivative-ubuntu-mint">Debian derivative; Ubuntu, Mint...</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>sudo apt install g++-mipsel-linux-gnu cpp-mipsel-linux-gnu binutils-mipsel-linux-gnu
</code></pre></div>
</td></tr></table>
<h4 id="arch-derivative-manjaro">Arch derivative; Manjaro...</h4>
<p>The mipsel environment can be installed from <a href="https://wiki.archlinux.org/index.php/Aur">AUR</a> : <a href="https://aur.archlinux.org/packages/cross-mipsel-linux-gnu-binutils/">cross-mipsel-linux-gnu-binutils</a> and <a href="https://aur.archlinux.org/packages/cross-mipsel-linux-gnu-gcc/">cross-mipsel-linux-gnu-gcc</a> using your <a href="https://wiki.archlinux.org/index.php/AUR_helpers">AURhelper</a> of choice:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>trizen -S cross-mipsel-linux-gnu-binutils cross-mipsel-linux-gnu-gcc
</code></pre></div>
</td></tr></table>
<h2 id="cli-flags">Cli &amp; flags</h2>
<h1 id="command-line-flags">Command Line Flags</h1>
<p>You can launch <code>pcsx-redux</code> with the following command line parameters:</p>
<p><strong>The parsing code doesn't care about the number of dashes in the parameter's flag, so '-' can be used as well as '--', or any number of dashes.</strong></p>
<table>
<thead>
<tr>
<th align="left">Flag</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>-dumpproto</code></td>
<td align="left">Dump the protobuf schemas for PCSX-Redux on stdout and exit immediately.</td>
</tr>
<tr>
<td align="left"><code>-run</code></td>
<td align="left">Begin execution immediately on startup.</td>
</tr>
<tr>
<td align="left"><code>-stdout</code></td>
<td align="left">Redirect log output to stdout.</td>
</tr>
<tr>
<td align="left"><code>-lua_stdout</code></td>
<td align="left">Redirect Lua's console output to stdout.</td>
</tr>
<tr>
<td align="left"><code>-logfile</code></td>
<td align="left">Specify a file to log output to.</td>
</tr>
<tr>
<td align="left"><code>-bios</code></td>
<td align="left">Specify a BIOS file.</td>
</tr>
<tr>
<td align="left"><code>-testmode</code></td>
<td align="left">Interpret <a href="../mips_api/">internal API</a>'s <code>pcsx_exit()</code> command and close the emulator.</td>
</tr>
<tr>
<td align="left"><code>-exe</code></td>
<td align="left">Load a PSX exe.</td>
</tr>
<tr>
<td align="left"><code>-loadexe</code></td>
<td align="left">Load a PSX exe.</td>
</tr>
<tr>
<td align="left"><code>-iso</code></td>
<td align="left">Load a PSX disk image (iso, bin/cue).</td>
</tr>
<tr>
<td align="left"><code>-loadiso</code></td>
<td align="left">Load a PSX disk image (iso, bin/cue).</td>
</tr>
<tr>
<td align="left"><code>-memcard1</code></td>
<td align="left">Specify a memory card file to use as memory card slot 1.</td>
</tr>
<tr>
<td align="left"><code>-memcard2</code></td>
<td align="left">Specify a memory card file to use as memory card slot 2.</td>
</tr>
<tr>
<td align="left"><code>-pcdrv</code></td>
<td align="left">Enable the pcdrv device interface. (Access PC filesystem through SIO).</td>
</tr>
<tr>
<td align="left"><code>-pcdrvbase</code></td>
<td align="left">Specify base directory for pcdrv.</td>
</tr>
<tr>
<td align="left"><code>-safe</code></td>
<td align="left">Resets configuration to defaults.</td>
</tr>
<tr>
<td align="left"><code>-interpreter</code></td>
<td align="left">Use the interpreter CPU core.</td>
</tr>
<tr>
<td align="left"><code>-dynarec</code></td>
<td align="left">Use the dynamic recompiler CPU core.</td>
</tr>
<tr>
<td align="left">## Gdb-server</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h1 id="gdb-server">GDB server</h1>
<p>The GDB server allows you to set breakpoints  and control your PSX program's execution from your gdb compatible IDE.</p>
<h2 id="enabling-the-gdb-server">Enabling the GDB server</h2>
<p><img alt="Enable gdb server" src="../images/gdb-server-enable.png"/> </p>
<p>In PCSX-Redux:  <code>Configuration &gt; Emulation &gt; Enable GDB server</code>.   </p>
<p>Make sure the debugger is also enabled.  </p>
<p><img alt="enable debugger/gdb" src="../images/pcsx_enable_debugger.png"/> </p>
<h2 id="gdb-setup">GDB setup</h2>
<p>You need <code>gdb-multiarch</code> on your system :</p>
<h3 id="windows_1">Windows</h3>
<p>Download a pre-compiled version from here : <a href="https://static.grumpycoder.net/pixel/gdb-multiarch-windows/">https://static.grumpycoder.net/pixel/gdb-multiarch-windows/</a></p>
<h3 id="gnulinux">GNU/Linux</h3>
<p>Install via your package manager :</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1"># Debian derivative; Ubuntu, Mint...</span>
sudo apt install gdb-multiarch
<span class="c1"># Arch derivative; Manjaro</span>
<span class="c1"># 'gdb-multiarch' is available in aur : https://aur.archlinux.org/packages/gdb-multiarch/</span>
sudo trizen -S gdb-multiarch
</code></pre></div>
</td></tr></table>
<h2 id="ide-setup">IDE setup</h2>
<h3 id="ms-vscode">MS VScode</h3>
<ul>
<li>Install the <code>Native debug</code>  extension :<br/>
<a href="https://marketplace.visualstudio.com/items?itemName=webfreak.debug">https://marketplace.visualstudio.com/items?itemName=webfreak.debug</a></li>
</ul>
<p><img alt="VScode native debg extension" src="../images/vscode_native_debug.png"/> </p>
<ul>
<li>Adapt your <code>launch.json</code> file to your environment :<br/>
  A sample <code>lanuch.json</code> file is available <a href="https://github.com/NDR008/VSCodePSX/blob/main/get_started/.vscode/launch.json">here</a>.<br/>
  This should go in <code>your-project/.vscode/</code>.  </li>
</ul>
<p>You need to adapt the values of <code>"target"</code>, <code>"gdbpath"</code> and <code>"autorun"</code> according to your system :</p>
<h4 id="target">target</h4>
<p>This is the path to your <code>.elf</code> executable :<br/>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>   <span class="nt">"target"</span><span class="p">:</span> <span class="s2">"HelloWorld.elf"</span><span class="p">,</span>
</code></pre></div>
</td></tr></table>
<a href="https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L9">https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L9</a> </p>
<h4 id="gdbpath">gdbpath</h4>
<p>This the path to the <code>gdb-multiarch</code> executable:<br/>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>   <span class="nt">"gdbpath"</span><span class="p">:</span> <span class="s2">"/usr/bin/gdb-multiarch"</span><span class="p">,</span>
</code></pre></div>
</td></tr></table>
<a href="https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L10">https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L10</a></p>
<h4 id="autorun">autorun</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>   <span class="nt">"autorun"</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">"target remote localhost:3333"</span><span class="p">,</span>
    <span class="p">[</span><span class="err">...</span><span class="p">]</span>
    <span class="s2">"load HelloWorld.elf"</span><span class="p">,</span>
</code></pre></div>
</td></tr></table>
<p>Make sure that <code>"load your-file.elf"</code> corresponds to the <code>"target"</code> value.  </p>
<p><a href="https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L15">https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L15</a></p>
<p>By default, using <code>localhost</code> should work, but if encountering trouble, try using your computer's local IP (e.g; 192.168.x.x, 10.0.x.x, etc.)</p>
<p><a href="https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L13">https://github.com/NDR008/VSCodePSX/blob/d70658b5ad420685367de4f3c18b89d72535631e/get_started/.vscode/launch.json#L13</a></p>
<p><img alt="gdb debugging" src="../images/pcsx-gdb-debug.png"/></p>
<h3 id="geany">Geany</h3>
<p>Make sure you installed the <a href="https://www.geany.org/download/releases/#geany-plugins-releases">official plugins</a> and enable the <code>Scope debugger</code>.</p>
<p>To enable the plugin, open Geany, go to <code>Tools &gt; Plugin manager</code> and enable <code>Scope Debugger</code>.</p>
<p>You can find the debugging facilities  in the <code>Debug</code> menu ;</p>
<p><img alt="geany program setup" src="../images/geany-gdb-scope-menu.png"/></p>
<p>You can find the plugin's documentation here : <a href="https://plugins.geany.org/scope.html">https://plugins.geany.org/scope.html</a></p>
<h4 id="gdbinit">.gdbinit</h4>
<p>Create a <code>.gdbinit</code> file at the root of your project with the following content, adapting the path to your <code>elf</code> file and the gdb server's ip.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>target remote localhost:3333
symbol-file load /path/to/your/executable.elf
monitor reset shellhalt
load /path/to/your/executable.elf
</code></pre></div>
</td></tr></table>
<h4 id="plugin-configuration">Plugin configuration</h4>
<p>In Geany : <code>Debug &gt; Setup Program</code> :  </p>
<p><img alt="geany program setup" src="../images/geany-gdb-scope-options.png"/></p>
<h2 id="beginning-debugging">Beginning Debugging</h2>
<p>Launch <code>pcsx-redux</code>, then run the debugger from your IDE. It should load the <code>elf</code> file, and execute until the next breakpoint.</p>
<h3 id="starting-debugging-in-geany">Starting debugging in Geany</h3>
<video controls="" height="360" width="640">
<source src="https://archive.org/download/pcsx_redux_geany_gdb/pcsx_redux_geany_gdb.webm" type="video/webm"/>
Your browser does not support the video tag.
</video>
<p>Source :<br/>
<a href="https://archive.org/details/pcsx_redux_geany_gdb">https://archive.org/details/pcsx_redux_geany_gdb</a></p>
<h2 id="additional-tools">Additional tools</h2>
<p><a href="https://github.com/cyrus-and/gdb-dashboard/">https://github.com/cyrus-and/gdb-dashboard/</a></p>
<h2 id="mips-api">Mips &amp; api</h2>
<h1 id="mips-api_1">Mips API</h1>
<h2 id="description">Description</h2>
<p>PCSX-Redux has a special API that mips binaries can use : </p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="n">pcsx_putc</span><span class="p">(</span><span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="p">)</span><span class="mh">0x1f802080</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="n">pcsx_debugbreak</span><span class="p">()</span> <span class="p">{</span> <span class="o">*</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">char</span><span class="o">*</span> <span class="k">const</span><span class="p">)</span><span class="mh">0x1f802081</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="n">pcsx_exit</span><span class="p">(</span><span class="kt">int</span> <span class="n">code</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">int16_t</span><span class="o">*</span> <span class="k">const</span><span class="p">)</span><span class="mh">0x1f802082</span><span class="p">)</span> <span class="o">=</span> <span class="n">code</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="n">pcsx_message</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">msg</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">char</span><span class="o">**</span> <span class="k">const</span><span class="p">)</span><span class="mh">0x1f802084</span><span class="p">)</span> <span class="o">=</span> <span class="n">msg</span><span class="p">;</span> <span class="p">}</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">int</span> <span class="n">pcsx_present</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="p">((</span><span class="k">volatile</span> <span class="kt">uint32_t</span><span class="o">*</span> <span class="k">const</span><span class="p">)</span><span class="mh">0x1f802080</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x58534350</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div>
</td></tr></table>
Source : <a href="https://github.com/grumpycoders/pcsx-redux/blob/main/src/mips/common/hardware/pcsxhw.h#L31-L36">https://github.com/grumpycoders/pcsx-redux/blob/main/src/mips/common/hardware/pcsxhw.h#L31-L36</a></p>
<p>The API needs <a href="https://psx-spx.consoledev.net/expansionportpio/#exp2-post-registers">DEV8/EXP2</a> (1f802000 to 1f80207f), which holds the hardware register for the bios POST status, to be expanded to 1f8020ff.<br/>
Thus the need to use a custom <code>crt0.s</code> if you plan on running your code on real hardware.<br/>
The default file provided with the <a href="https://github.com/pcsx-redux/nugget">Nugget+PsyQ</a> development environment does that:  </p>
<p><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="nl">_start:</span>
    <span class="nf">lw</span>    <span class="kc">$</span><span class="nv">t2</span><span class="p">,</span> <span class="nv">SBUS_DEV8_CTRL</span>
    <span class="nf">lui</span>   <span class="kc">$</span><span class="nv">t0</span><span class="p">,</span> <span class="mi">8</span>
    <span class="nf">lui</span>   <span class="kc">$</span><span class="nv">t1</span><span class="p">,</span> <span class="mi">1</span>
<span class="nl">_check_dev8:</span>
    <span class="nf">bge</span>   <span class="kc">$</span><span class="nv">t2</span><span class="p">,</span> <span class="kc">$</span><span class="nv">t0</span><span class="p">,</span> <span class="nv">_store_dev8</span>
    <span class="nf">nop</span>
    <span class="nf">b</span>     <span class="nv">_check_dev8</span>
    <span class="nf">add</span>   <span class="kc">$</span><span class="nv">t2</span><span class="p">,</span> <span class="kc">$</span><span class="nv">t1</span>
<span class="nl">_store_dev8:</span>
    <span class="nf">sw</span>    <span class="kc">$</span><span class="nv">t2</span><span class="p">,</span> <span class="nv">SBUS_DEV8_CTRL</span>
</code></pre></div>
</td></tr></table>
Source : <a href="https://github.com/grumpycoders/pcsx-redux/blob/main/src/mips/common/crt0/crt0.s#L36-L46">https://github.com/grumpycoders/pcsx-redux/blob/main/src/mips/common/crt0/crt0.s#L36-L46</a></p>
<h2 id="functions">Functions</h2>
<p>The following functions are available :</p>
<table>
<thead>
<tr>
<th align="left">Function</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>pcsx_putc(int c)</code></td>
<td align="left">Print ASCII character with code <code>c</code> to console/stdout.</td>
</tr>
<tr>
<td align="left"><code>pcsx_debugbreak()</code></td>
<td align="left">Break execution (Pause emulation).</td>
</tr>
<tr>
<td align="left"><code>pcsx_exit(int code)</code></td>
<td align="left">Exit emulator and forward <code>code</code> as exit code.</td>
</tr>
<tr>
<td align="left"><code>pcsx_message(const char* msg)</code></td>
<td align="left">Create a UI dialog displaying <code>msg</code></td>
</tr>
<tr>
<td align="left"><code>pcsx_present()</code></td>
<td align="left">Returns 1 if code is running in PCSX-Redux</td>
</tr>
</tbody>
</table>
<p>Example of a UI dialog created with <code>pcsx_message()</code> :  </p>
<p><img alt="pcsx_message() in action" src="../images/pcsx_message.png"/></p>
<h2 id="cpu-trace-dump">Cpu, trace &amp; dump</h2>
<h1 id="dumping-a-cpu-trace-to-a-file">Dumping a CPU trace to a file</h1>
<h2 id="setup">Setup</h2>
<p>In PCSX-Redux, make sure <code>Debug &gt; Show logs</code> is enabled.</p>
<p>In the 'Logs' window, hide all logs : <code>Displayed &gt; Hide all</code></p>
<p>To avoid unnecessary noise, you can also skip ISR during CPU traces : <code>Special &gt; Skip ISR during CPU traces</code></p>
<p><img alt="Hide all logs" src="../images/pcsx_cpu_dump_hide.png"/>
<img alt="Skip ISR during CPU traces" src="../images/pcsx_cpu_dump_isr.png"/></p>
<h2 id="begin-dump">Begin dump</h2>
<p>To dump the CPU traces, launch pcsx-redux with the following command :</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>pcsx-redux -stdout -logfile log.txt
<span class="c1"># Alternatively, you can use -stdout on its own and pipe the output to a file.</span>
pcsx-redux -stdout &gt;&gt; log.txt
</code></pre></div>
</td></tr></table>
<p>You can use <a href="../cli_flags/">additional flags</a> to launch an executable/disk image in one go, e.g :</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>pcsx-redux -stdout -logfile tst.log -iso image.cue -run
</code></pre></div>
</td></tr></table>
<h2 id="source">Source</h2>
<p><a href="https://discord.com/channels/642647820683444236/663664210525290507/882608398993063997">https://discord.com/channels/642647820683444236/663664210525290507/882608398993063997</a></p>
<h2 id="web-server">Web &amp; server</h2>
<h1 id="web-server_1">Web server</h1>
<p>A web server can be activated. This allows the use of a REST api to access various features.</p>
<h2 id="activation">Activation</h2>
<p>You can activate the web server by going to <code>Configuration &gt; Emulation &gt; Enable Web Server</code></p>
<h2 id="rest-api">REST API</h2>
<p>By default, the server listens for incoming connection on <code>localhost:8080</code>.</p>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><a href="http://localhost:8080/api/v1/gpu/vram/raw">http://localhost:8080/api/v1/gpu/vram/raw</a></td>
<td align="left">Dump VRAM</td>
</tr>
<tr>
<td align="left"><a href="http://localhost:8080/api/v1/cpu/ram/raw">http://localhost:8080/api/v1/cpu/ram/raw</a></td>
<td align="left">Dump RAM</td>
</tr>
</tbody>
</table>
<h2 id="lua">Lua</h2>
<h1 id="lua-api">Lua API</h1>
<p>PCSX-Redux features a Lua API that's available through either a direct Lua console, or a Lua editor, both available through the Debug menu.</p>
<h2 id="lua-engine">Lua engine</h2>
<p>The Lua engine that's being used is LuaJIT 2.1.0-beta3. The <a href="https://www.lua.org/manual/5.1/">Lua 5.1 user manual</a> and <a href="https://luajit.org/extensions.html">LuaJIT user manual</a> are recommended reads. In particular, the bindings heavily make use of LuaJIT's FFI capabilities, which allows for direct memory access within the emulator's process. This means there is little protection against dramatic crashes the LuaJIT FFI engine can cause into the emulator's process, and the user must pay extra attention while manipulating FFI objects. Despite that, the code tries as much as possible to sandbox what the Lua code does, and will prevent crashes on any recoverable exception, including OpenGL and ImGui exceptions.</p>
<h2 id="lua-console">Lua console</h2>
<p>All of the messages coming from Lua should display into the Lua console directly. The input text there is a single line execution, so the user can type one-liner Lua statements and get an immediate result.</p>
<h2 id="lua-editor">Lua editor</h2>
<p>The editor allows for more complex, multi-line statements to be written, such as complete functions. The editor will by default auto save its contents on the disc under the filename <code>pcsx.lua</code>, which can potentially be a problem if the last statement typed crashed the emulator, as it'll be reloaded on the next startup. It might become necessary to either edit the file externally, or simply delete it to recover from this state.</p>
<p>The auto-execution of the editor permits for rapid development loop, with immediate feedback of what's done.</p>
<h2 id="api">API</h2>
<h3 id="basic-lua">Basic Lua</h3>
<p>The <a href="https://luajit.org/extensions.html">LuaJIT extensions</a> are fully loaded, and can be used globally. Most of the <a href="https://www.lua.org/manual/5.1/manual.html#5">standard Lua libraries</a> are loaded, and are usable. The <code>require</code> keyword however doesn't exist at the moment. As a side-effect of Luv, <a href="https://github.com/keplerproject/lua-compat-5.3">Lua-compat-5.3</a> is loaded.</p>
<h3 id="dear-imgui">Dear ImGui</h3>
<p>A good portion of <a href="https://github.com/ocornut/imgui">ImGui</a> is bound to the Lua environment, and it's possible for the Lua code to emit arbitrary widgets through ImGui. It is advised to consult the <a href="https://pthom.github.io/imgui_manual_online/manual/imgui_manual.html">user manual</a> of ImGui in order to properly understand how to make use of it. The list of current bindings can be found <a href="https://github.com/grumpycoders/pcsx-redux/blob/main/third_party/imgui_lua_bindings/imgui_iterator.inl">within the source code</a>. Some usage examples will be provided within the case studies.</p>
<h3 id="opengl">OpenGL</h3>
<p>OpenGL is bound directly to the Lua API through FFI bindings, loosely inspired and adapted from <a href="https://github.com/malkia/luajit-opencl">LuaJIT-OpenCL</a>. Some usage examples can be seen in the CRT-Lottes shader configuration page.</p>
<h3 id="luv">Luv</h3>
<p>For network access and interaction, PCSX-Redux uses libuv internally, and this is exposed to the Lua API through <a href="https://github.com/luvit/luv">Luv</a></p>
<h3 id="zlib">Zlib</h3>
<p>The Zlib C-API is exposed through <a href="https://github.com/luapower/zlib">FFI bindings</a>.</p>
<h3 id="pcsx-redux">PCSX-Redux</h3>
<h4 id="imgui-interaction">ImGui interaction</h4>
<p>PCSX-Redux will periodically try to call the Lua function <code>DrawImguiFrame</code> to allow the Lua code to draw some widgets on screen. The function will be called exactly once per actual UI frame draw, which, when the emulator is running, will correspond to the emulated GPU's vsync. If the function throws an exception however, it will be disabled until recompiled with new code.</p>
<h4 id="memory-and-registers">Memory and registers</h4>
<p>The Lua code can access the emulated memory and registers directly through some FFI bindings:</p>
<ul>
<li><code>PCSX.getMemPtr()</code> will return a <code>cdata[uint8_t*]</code> representing up to 8MB of emulated memory. This can be written to, but careful about the emulated i-cache in case code is being written to.</li>
<li><code>PCSX.getRomPtr()</code> will return a <code>cdata[uint8_t*]</code> representing up to 512kB of the BIOS memory space. This can be written to.</li>
<li><code>PCSX.getScratchPtr()</code> will return a <code>cdata[uint8_t*]</code> representing up to 1kB for the scratchpad memory space.</li>
<li><code>PCSX.getRegisters()</code> will return a structured cdata representing all the registers present in the CPU:</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
        <span class="kt">uint32_t</span> <span class="n">r0</span><span class="p">,</span> <span class="n">at</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span><span class="p">,</span> <span class="n">t5</span><span class="p">,</span> <span class="n">t6</span><span class="p">,</span> <span class="n">t7</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">,</span> <span class="n">s5</span><span class="p">,</span> <span class="n">s6</span><span class="p">,</span> <span class="n">s7</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">t8</span><span class="p">,</span> <span class="n">t9</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">gp</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="n">s8</span><span class="p">,</span> <span class="n">ra</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">n</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">r</span><span class="p">[</span><span class="mi">34</span><span class="p">];</span>
<span class="p">}</span> <span class="n">psxGPRRegs</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">r</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">psxCP0Regs</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">r</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">psxCP2Data</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
    <span class="kt">uint32_t</span> <span class="n">r</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">psxCP2Ctrl</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">psxGPRRegs</span> <span class="n">GPR</span><span class="p">;</span>
    <span class="n">psxCP0Regs</span> <span class="n">CP0</span><span class="p">;</span>
    <span class="n">psxCP2Data</span> <span class="n">CP2D</span><span class="p">;</span>
    <span class="n">psxCP2Ctrl</span> <span class="n">CP2C</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">pc</span><span class="p">;</span>
<span class="p">}</span> <span class="n">psxRegisters</span><span class="p">;</span>
</code></pre></div>
</td></tr></table>
<h4 id="execution-flow">Execution flow</h4>
<p>The Lua code has the following 4 API functions available to it in order to control the execution flow of the emulator:</p>
<ul>
<li><code>PCSX.pauseEmulator()</code></li>
<li><code>PCSX.resumeEmulator()</code></li>
<li><code>PCSX.softResetEmulator()</code></li>
<li><code>PCSX.hardResetEmulator()</code></li>
</ul>
<h4 id="messages">Messages</h4>
<p>The globals <code>print</code> and <code>printError</code> are available, and will display logs in the Lua Console. You can also use <code>PCSX.log</code> to display a line in the general Log window. All three functions should behave the way you'd expect from a <code>print</code> function in Lua.</p>
<h4 id="gui">GUI</h4>
<p>You can move the cursor within the assembly window and the first memory view using the following two functions:</p>
<ul>
<li><code>PCSX.GUI.jumpToPC(pc)</code></li>
<li><code>PCSX.GUI.jumpToMemory(address[, width])</code></li>
</ul>
<h4 id="breakpoints">Breakpoints</h4>
<p>If the debugger is activated, and while using the interpreter, the Lua code can insert powerful breakpoints using the following API:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">PCSX</span><span class="p">.</span><span class="n">addBreakpoint</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">invoker</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>
<p><strong>Important</strong>: the return value of this function will be an object that represents the breakpoint itself. If this object gets garbage collected, the corresponding breakpoint will be removed. Thus it is important to store it somewhere that won't get garbage collected right away.</p>
<p>The only mandatory argument is <code>address</code>, which will by default place an execution breakpoint at the corresponding address. The second argument <code>type</code> is an enum which can be represented by one of the 3 following strings: <code>'Exec'</code>, <code>'Read'</code>, <code>'Write'</code>, and will set the breakpoint type accordingly. The third argument <code>width</code> is the width of the breakpoint, which indicates how many bytes should intersect from the base address with operations done by the emulated CPU in order to actually trigger the breakpoint. The fourth argument <code>cause</code> is a string that will be displayed in the logs about why the breakpoint triggered. It will also be displayed in the Breakpoint Debug UI. And the fifth and final argument <code>invoker</code> is a Lua function that will be called whenever the breakpoint is triggered. By default, this will simply call <code>PCSX.pauseEmulator()</code>. If the invoker returns <code>false</code>, the breakpoint will be permanently removed, permitting temporary breakpoints for example.</p>
<p>The returned object will have a few methods attached to it:</p>
<ul>
<li><code>:disable()</code></li>
<li><code>:enable()</code></li>
<li><code>:isEnabled()</code></li>
<li><code>:remove()</code></li>
</ul>
<p>A removed breakpoint will no longer have any effect whatsoever, and none of its methods will do anything. Remember it is possible for the user to still manually remove a breakpoint from the UI.</p>
<h2 id="case-studies">Case studies</h2>
<h3 id="spyro-year-of-the-dragon">Spyro: Year of the Dragon</h3>
<p>By looking up some of the <a href="https://www.cheatcc.com/psx/codes/spyroyotd.html">gameshark codes</a> for this game, we can determine the following memory addresses:</p>
<ul>
<li><code>0x8007582c</code> is the number of lives.</li>
<li><code>0x80078bbc</code> is the health of Spyro.</li>
<li><code>0x80075860</code> is the number of unspent jewels available to the player.</li>
<li><code>0x80075750</code> is the number of dragons Spyro released so far.</li>
</ul>
<p>With this, we can build a small UI to visualize and manipulate these values in real time:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">-- Declare a helper function with the following arguments:</span>
<span class="c1">--   mem: the ffi object representing the base pointer into the main RAM</span>
<span class="c1">--   address: the address of the uint32_t to monitor and mutate</span>
<span class="c1">--   name: the label to display in the UI</span>
<span class="c1">--   min, max: the minimum and maximum values of the slider</span>
<span class="c1">--</span>
<span class="c1">-- This function is local as to not pollute the global namespace.</span>
<span class="kd">local</span> <span class="kr">function</span> <span class="nf">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">)</span>
  <span class="c1">-- Clamping the address to the actual memory space, essentially</span>
  <span class="c1">-- removing the upper bank address using a bitmask. The result</span>
  <span class="c1">-- will still be a normal 32-bits value.</span>
  <span class="n">address</span> <span class="o">=</span> <span class="n">bit</span><span class="p">.</span><span class="n">band</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="mh">0x1fffff</span><span class="p">)</span>
  <span class="c1">-- Computing the FFI pointer to the actual uint32_t location.</span>
  <span class="c1">-- The result will be a new FFI pointer, directly into the emulator's</span>
  <span class="c1">-- memory space, hopefully within normal accessible bounds. The</span>
  <span class="c1">-- resulting type will be a cdata[uint8_t*].</span>
  <span class="kd">local</span> <span class="n">pointer</span> <span class="o">=</span> <span class="n">mem</span> <span class="o">+</span> <span class="n">address</span>
  <span class="c1">-- Casting this pointer to a proper uint32_t pointer.</span>
  <span class="n">pointer</span> <span class="o">=</span> <span class="n">ffi</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">'uint32_t*'</span><span class="p">,</span> <span class="n">pointer</span><span class="p">)</span>
  <span class="c1">-- Reading the value in memory</span>
  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="c1">-- Drawing the ImGui slider</span>
  <span class="kd">local</span> <span class="n">changed</span>
  <span class="n">changed</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">imgui</span><span class="p">.</span><span class="n">SliderInt</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="s1">'%d'</span><span class="p">)</span>
  <span class="c1">-- The ImGui Lua binding will first return a boolean indicating</span>
  <span class="c1">-- if the user moved the slider. The second return value will be</span>
  <span class="c1">-- the new value of the slider if it changed. Therefore we can</span>
  <span class="c1">-- reassign the pointer accordingly.</span>
  <span class="kr">if</span> <span class="n">changed</span> <span class="kr">then</span> <span class="n">pointer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="kr">end</span>
<span class="kr">end</span>

<span class="c1">-- Utilizing the DrawImguiFrame periodic function to draw our UI.</span>
<span class="c1">-- We are declaring this function global so the emulator can</span>
<span class="c1">-- properly call it periodically.</span>
<span class="kr">function</span> <span class="nf">DrawImguiFrame</span><span class="p">()</span>
  <span class="c1">-- This is typical ImGui paradigm to display a window</span>
  <span class="kd">local</span> <span class="n">show</span> <span class="o">=</span> <span class="n">imgui</span><span class="p">.</span><span class="n">Begin</span><span class="p">(</span><span class="s1">'Spyro internals'</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">show</span> <span class="kr">then</span> <span class="n">imgui</span><span class="p">.</span><span class="n">End</span><span class="p">()</span> <span class="kr">return</span> <span class="kr">end</span>

  <span class="c1">-- Grabbing the pointer to the main RAM, to avoid calling</span>
  <span class="c1">-- the function for every pointer we want to change.</span>
  <span class="c1">-- Note: it's not a good idea to hold onto this value between</span>
  <span class="c1">-- calls to the Lua VM, as the memory can potentially move</span>
  <span class="c1">-- within the emulator's memory space.</span>
  <span class="kd">local</span> <span class="n">mem</span> <span class="o">=</span> <span class="n">PCSX</span><span class="p">.</span><span class="n">getMemPtr</span><span class="p">()</span>

  <span class="c1">-- Now calling our helper function for each of our pointer.</span>
  <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x8007582c</span><span class="p">,</span> <span class="s1">'Lives'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
  <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80078bbc</span><span class="p">,</span> <span class="s1">'Health'</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80075860</span><span class="p">,</span> <span class="s1">'Jewels'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">65000</span><span class="p">)</span>
  <span class="n">doSliderInt</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span> <span class="mh">0x80075750</span><span class="p">,</span> <span class="s1">'Dragons'</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>

  <span class="c1">-- Don't forget to close the ImGui window.</span>
  <span class="n">imgui</span><span class="p">.</span><span class="n">End</span><span class="p">()</span>
<span class="kr">end</span>
</code></pre></div>
</td></tr></table>
<p>You can see this code in action <a href="https://youtu.be/WeHXTLDy5rs">in this demo video</a>.</p>
<h2 id="openbios_3">Openbios</h2>
<h1 id="openbios_4">Openbios</h1>
<p><a href="https://github.com/grumpycoders/pcsx-redux/tree/main/src/mips/openbios">Openbios</a> is, as its name implies, an open-source alternative to a retail PSX bios that can be non-trivial to dump.</p>
<h2 id="purposes-of-openbios">Purposes of Openbios</h2>
<ul>
<li>Educational</li>
<li>Ease of distribution</li>
<li>Automated testing</li>
</ul>
<p>See <a href="https://github.com/grumpycoders/pcsx-redux/tree/main/src/mips/openbios">this page</a> for more details.</p>
<h2 id="building">Building</h2>
<p>It is compiled together with <code>pcsx-redux</code> or can be compiled on its own.  </p>
<p>See the corresponding sections in <a href="../compiling/">Compiling</a> for instructions.  </p>
<p>The result of the compilation should be a file called <code>openbios.elf</code> that contains all useful debugging symbols,<br/>
and a file called <code>openbios.bin</code> which can be used in emulators or even burned to a chip and placed on a retail console.  </p>
<h2 id="status">Status</h2>
<p>This subproject is still under construction, but is fairly functional and usable. OpenBIOS does almost all the same things as the retail BIOS does when booting, and implements most of its features.<br/>
<a href="https://docs.google.com/spreadsheets/d/1UNGs7uYb8viAbm7YJaf1CR4dkgX7ZzntUdcowGsjcVc/edit?usp=sharing">Many games</a> are booting and working properly with this code.<br/>
It can be used in emulators or on the real console, either while replacing the rom chip, or by using the "cart" build and programming the flash chip of a cheat cart with the result.</p>
<h2 id="organization">Organization</h2>
<p>The BIOS is split in two major parts: the low level code for the bios itself, and the shell, which is the binary that's being loaded into memory at boot time by the bios, to display the SONY sound and logo, and has a small utility menu for playing audio discs, or shuffling around memory cards.</p>
<p>While the first part is the main one that's being targeted here, the second one isn't currently present. This may change in the future, but this isn't currently the focus of this project.</p>
<p>The original code was most likely chunked into several sub-projects, that were all linked together like a giant patchwork. This approach is less readable, and for this reason, we're not going to do this.<br/>
However this will result in the ROM/RAM split to be less obvious, and slower at times than the original. Tuning of the hot functions is eventually required.</p>
<h2 id="technicalities">Technicalities</h2>
<p>The code has been rewritten based off the reverse engineering of a dump of the BIOS of an american <strong>SCPH-7001</strong> machine. <em>MD5sum: 1e68c231d0896b7eadcad1d7d8e76129</em></p>
<p>The ghidra database for it is currently being hosted on a server, alongside a few other pieces of software being reversed. Contact one of the authors if you want access.</p>
<h2 id="commentary">Commentary</h2>
<p>The retail PlayStation BIOS code is a constellation of bugs and bad design.<br/>
The fact that the retail console boots at all is nothing short of a miracle. Half of the provided libc in the A0 table is buggy.<br/>
The BIOS code is barely able to initialize the CD-Rom, and read the game's binary off of it to boot it; anything beyond that will be crippled with bugs.<br/>
And this only is viable if you respect a very strict method to create your CD-Rom. The memory card and gamepad code is a steaming-hot heap of human excrement.<br/>
The provided GPU stubs are inefficient at best.  </p>
<p>The only sane thing that any software running on the PlayStation ought to do is to immediately disable interrupts, grab the function pointer located at <em>0x00000310</em> for <code>FlushCache</code>,<br/>
in order put it inside a wrapper that disables interrupts before calling it, and then trash the whole memory to install its own code.<br/>
The only reason <code>FlushCache</code> is required from the retail code is because since the function will unplug the main memory bus off the CPU in order to work, it HAS to run from the <em>0xbfc</em> memory map, which will still be connected.<br/>
Anything else from the retail code is virtually useless, and shouldn't be relied upon.  </p>
<h2 id="legality">Legality</h2>
<p><em>Disclaimer: the author is not a lawyer, and the following statement hasn't been reviewed by a professional of the law, so the rest of this document cannot be taken as legal advice.</em> </p>
<p>As explained above, this code has been written using disassembly and reverse engineering of a retail bios the author dumped from a second hand console. The same exact methodology was employed by Connectix for their PS1 bios. The conclusion of <a href="https://en.wikipedia.org/wiki/Sony_Computer_Entertainment,_Inc._v._Connectix_Corp.">their lawsuit</a>, and that of <a href="https://en.wikipedia.org/wiki/Sega_Enterprises,_Ltd._v._Accolade,_Inc.">Sega v. Accolade</a> seems to indicate that this project here follows and is impacted by the same doctrine.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
 ... <a class="link--pdf-download" download href="../pcsx-redux.pdf" title="PDF">download PDF</a></div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
<script src="../assets/javascripts/bundle.4ea5477f.min.js"></script>
</body>
</html>